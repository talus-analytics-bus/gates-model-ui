var App=App||{};!function(){var t=function(){App.initialize(),Routing.precompileTemplates(),Routing.initializeRoutes()};t()}();var Routing={};!function(){var t={};Routing.precompileTemplates=function(){$("script[type='text/x-handlebars-template']").each(function(e,n){t[n.id.replace("-template","")]=Handlebars.compile($(n).html())})},Routing.initializeRoutes=function(){crossroads.addRoute("/",function(){n("home"),App.initInput(),window.scrollTo(0,0)}),crossroads.addRoute("/output",function(){n("output"),App.initOutput(),window.scrollTo(0,0)}),hasher.prependHash="",hasher.initialized.add(e),hasher.changed.add(e),hasher.init()};var e=function(t){crossroads.parse(t)},n=function(e,n){$("#page-content").html(t[e](n))}}();var Util={};Util.comma=d3.format(",f"),Util.decimalize=d3.format(".2f"),Util.percentize=d3.format("%"),Util.percentizeDiff=function(t){return 0===t?"0%":d3.format("+%")(t)},Util.strToFloat=function(t){return"string"!=typeof t?t:parseFloat(t.replace(/[^\d\.\-]/g,""))},Util.formatInputVal=function(t){t=$(t);var e=Util.strToFloat(t.val()),n=Util.comma(e);return t.hasClass("percent-input")&&(e/=100,isNaN(e)||0>e?e=0:e>100&&(e=100),n=Util.percentize(e)),t.val(n),e},Util.getUnique=function(t){for(var e=[],n=0;n<t.length;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e};var App=App||{};!function(){App.initInput=function(){$(".input-section .title").click(function(){var t=$(this).next().find(".input-subsection, .next-button-container"),e=t.is(":visible");e?t.slideUp():($(this).parent().siblings(".input-section").find(".input-subsection, .next-button-container").slideUp(),t.slideDown())}),$(".next-button-container .btn").click(function(){var t=!0;if("pop-age"===$(this).attr("name")&&(t=n()),t){var e=$(this).parent().parent();e.slideUp(),e.parent().next(".input-section").find(".input-subsection, .next-button-container").slideDown()}});var t=[{age:"0-5",value:.2},{age:"5-15",value:.34},{age:"16+",value:.46}];d3.selectAll(".pop-age-table input").property("value",function(e,n){return Util.percentize(t[n].value)}).on("change",function(n,i){t[i].value=Util.formatInputVal(this),e(),p()});var e=function(){for(var e=0,n=0;n<t.length;n++)e+=t[n].value;return $(".pop-age-table tbody tr:last-child td:nth-child(2)").text(Util.percentize(e)),Math.abs(e-1)<.001?($(".pop-age-warning").slideUp(),$(".pop-age-table input").css("background-color","white"),!0):($(".pop-age-warning").slideDown(),$(".pop-age-table input").css("background-color","#ffdbdb"),!1)},n=function(){var t=e();return t||noty({layout:"center",type:"warning",text:"<b>Warning!</b><br>Age distributions must sum to 100%!"}),t},i={top:25,right:20,bottom:20,left:100},a=420-i.left-i.right,r=200-i.top-i.bottom,o=d3.select(".pop-age-chart").attr("width",a+i.left+i.right).attr("height",r+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),s=d3.scale.ordinal().domain(t.map(function(t){return t.age})).rangeRoundBands([0,a],.2),l=d3.svg.axis().scale(s).orient("bottom"),c=(o.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(l),d3.scale.linear().domain([0,1]).range([r,0])),u=d3.svg.axis().orient("left").ticks(5).tickFormat(Util.percentize).innerTickSize(-a).outerTickSize(0).scale(c),p=(o.append("g").attr("class","y axis").call(u),function(){var e=o.selectAll("rect").data(t);e.enter().append("rect");e.attr("x",function(t){return s(t.age)}).attr("y",function(t){return c(t.value)}).attr("width",s.rangeBand()).attr("height",function(t){return r-c(t.value)}),e.exit().remove()});p(),$(".schisto-age-select").multiselect(),$(".malaria-timing-select").on("change",function(){"seasonal"===$(this).val()?$(".malaria-month-container").slideDown():$(".malaria-month-container").slideUp()}),$(".malaria-month-select").multiselect(),$(".irs-checkbox").on("change",function(){$(".irs-true-contents").slideToggle(),d()}),$(".itn-checkbox").on("change",function(){$(".itn-true-contents").slideToggle(),d()});var d=function(){var t=$(".irs-checkbox").is(":checked")&&$(".itn-checkbox").is(":checked");t?$('.input-subsection[name="distribution-strategy"]').slideDown():$('.input-subsection[name="distribution-strategy"]').slideUp()};$(".input-submit-button").click(function(){var t=n();t&&hasher.setHash("output")}),$('.input-section[name="pop-age"]').find(".input-subsection, .next-button-container").slideDown()}}();var App=App||{};!function(){App.initOutput=function(){var t=[{type:"without integration",schisto:.36,malaria:.42},{type:"with integration",schisto:.23,malaria:.35}];d3.selectAll(".output-table tbody tr").each(function(e,n){d3.select(this).select("td:nth-child(2)").text(Util.percentize(t[n].schisto)),d3.select(this).select("td:nth-child(3)").text(Util.percentize(t[n].malaria))});var e=[{type:"without integration",disease:"schisto",value:.36},{type:"without integration",disease:"malaria",value:.42},{type:"with integration",disease:"schisto",value:.23},{type:"with integration",disease:"malaria",value:.35}],n={top:30,right:20,bottom:80,left:80},i=650-n.left-n.right,a=250-n.top-n.bottom,r=d3.select(".output-bar-chart").attr("width",i+n.left+n.right).attr("height",a+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),o=d3.scale.ordinal().domain(Util.getUnique(e.map(function(t){return t.disease}))).rangeRoundBands([0,i],.5),s=d3.svg.axis().scale(o).orient("bottom"),l=(r.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(s),d3.scale.linear().domain([0,.5]).range([a,0])),c=d3.svg.axis().orient("left").ticks(5).tickFormat(Util.percentize).innerTickSize(-i).outerTickSize(0).scale(l),u=(r.append("g").attr("class","y axis").call(c),r.selectAll("rect").data(e));u.enter().append("rect").attr("class","bar");u.style("fill",function(t){return"without integration"===t.type?"url(#diagonal-stripe-1)":"steelblue"}).attr("x",function(t){var e=o(t.disease)-20;return"with integration"===t.type&&(e+=40),e}).attr("y",function(t){return l(t.value)}).attr("width",o.rangeBand()).attr("height",function(t){return a-l(t.value)}),u.exit().remove();var p=r.append("g").attr("class","legend").attr("transform","translate(100,"+(a+50)+")"),d=p.selectAll("g").data(Util.getUnique(e.map(function(t){return t.type}))).enter().append("g").attr("transform",function(t,e){return"translate("+200*e+")"});d.append("rect").attr("width",15).attr("height",15).style("fill",function(t){return"without integration"===t?"url(#diagonal-stripe-1)":"steelblue"}),d.append("text").attr("transform","translate(25,13)").text(function(t){return t});var h=[{type:"0.3",30:[.04,.04],50:[.03,.01],80:[-.03,.01],100:[-.13,.01]},{type:"0.5",30:[.02,-.01],50:[.02,-.01],80:[-.12,-.03],100:[-.13,-.01]},{type:"0.8",30:[-.01,-.01],50:[0,-.06],80:[-.1,-.07],100:[-.14,-.08]},{type:"1",30:[-.01,-.07],50:[-.05,-.09],80:[-.09,-.09],100:[-.14,-.1]}],g=["rgba(252,141,89,0.5)","rgba(254,224,139,0.5)","rgba(255,255,191,0.5)","rgba(217,239,139,0.65)","rgba(145,207,96,0.5)"],f=(d3.scale.threshold().domain([-.095,-.045,-.025,.001]).range(g),function(t){var e=d3.select(".output-matrix-table tbody").selectAll("tr").data(t),n=(e.enter().append("tr"),e.selectAll("td").data(function(t){return["type","30","50","80","100"].map(function(e){return t[e]})}));n.enter().append("td"),e.selectAll("td").classed("success",function(t,e){return e>0?(t[0]+t[1])/2<0:void 0}).classed("danger",function(t,e){return e>0?(t[0]+t[1])/2>0:void 0}).html(function(t,e){if(0===e)return Util.percentize(t);var n=(t[0]+t[1])/2<0?"YES":"NO",i=t[0]>0?"text-danger":t[0]<0?"text-success":"",a=t[1]>0?"text-danger":t[1]<0?"text-success":"",r='<div class="matrix-cell-yes">'+n+"</div>";return r+='<div class="matrix-cell-perc">(',r+='<span class="'+i+'">'+Util.percentizeDiff(t[0])+"</span>",r+=" / ",r+='<span class="'+a+'">'+Util.percentizeDiff(t[1])+"</span>",r+=")</div>"}),d3.select(".output-matrix-table tbody tr:nth-child(3) td:nth-child(4)").style("font-weight","600").append("div").attr("class","selected-border-box")});f(h),$(".input-back-button").click(function(){hasher.setHash("")})}}();var App=App||{};!function(){App.initialize=function(){$(".header-title").click(function(){hasher.setHash("")});var t={input:"testing 1,2"};$.get("/runModel",t,function(t){console.log("got data"),console.log(t)})}}();